<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Super‚ÄêVerbose Debug</title>
  <style>
    body{font-family:monospace;background:#111;color:#eee;padding:1rem}
    label{display:block;margin:0.5rem 0}
    button{margin:0.5rem 0}
    pre{background:#222;color:#0f0;padding:1rem;max-height:70vh;overflow:auto}
  </style>
</head>
<body>
  <h1>üåïüõ©Ô∏è Transit Checker ‚Äî Raw Dump</h1>

  <label>Lat: <input id="lat" value="37.4407"></label>
  <label>Lon: <input id="lon" value="-122.2312"></label>
  <label>Start: <input id="start" type="datetime-local" value="2025-05-01T00:00"></label>
  <label>End:   <input id="end"   type="datetime-local" value="2025-05-01T00:00:30"></label>
  <label>Radius (km): <input id="radius" value="50"></label>
  <button id="run">Run Full Dump</button>

  <pre id="output">Waiting‚Ä¶</pre>

  <script>
    const out = document.getElementById("output");
    function log(...a){ console.log(...a); out.textContent += a.map(x=>
      typeof x==="object"? JSON.stringify(x,null,2): x
    ).join(" ")+"\n"; }
    function error(...a){ console.error(...a); out.textContent+="[ERROR] "+a.join(" ")+"\n"; }

    document.getElementById("run").onclick = async () => {
      out.textContent = "";

      const lat = document.getElementById("lat").value,
            lon = document.getElementById("lon").value,
            start= document.getElementById("start").value,
            end  = document.getElementById("end").value,
            radius = document.getElementById("radius").value;

      log("Inputs:",{lat,lon,start,end,radius});
      const startISO=new Date(start).toISOString(),
            endISO  =new Date(end).toISOString();
      log("ISOs:",{startISO,endISO});

      // Moons
      const mURL=`/.netlify/functions/getMoonPositions?lat=${lat}&lon=${lon}`
                 +`&start=${encodeURIComponent(startISO)}&end=${encodeURIComponent(endISO)}&step=15`;
      log("MOON URL:",mURL);
      const mRes=await fetch(mURL);
      const mText=await mRes.text();
      log("MOON status",mRes.status);
      log("MOON raw text:",mText);
      let moonData;
      try { moonData=JSON.parse(mText); log("MOON parsed JSON:",moonData); }
      catch(e){ error("MOON JSON.parse failed:",e.message); }

      // Flights
      const fURL=`/.netlify/functions/getFlightPaths?lat=${lat}&lon=${lon}`
                 +`&start=${encodeURIComponent(startISO)}&end=${encodeURIComponent(endISO)}`
                 +`&step=15&radiusKm=${radius}`;
      log("FLIGHT URL:",fURL);
      const fRes=await fetch(fURL);
      const fText=await fRes.text();
      log("FLIGHT status",fRes.status);
      log("FLIGHT raw text:",fText);
      let flights;
      try { flights=JSON.parse(fText).flights; log("FLIGHT parsed JSON:",flights); }
      catch(e){ error("FLIGHT JSON.parse failed:",e.message); }

      // Done
      log("‚ú® Dump complete");
    };
  </script>
</body>
</html>

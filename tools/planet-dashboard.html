<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planets Dashboard – Hansen Space</title>

  <!-- GLOBAL -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Nunito+Sans&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">

  <!-- PAGE‑LOCAL STYLES -->
  <style>
    /* ---------- layout borrowed from base template ---------- */
    .content         { max-width:1500px; margin:0 auto; padding:30px var(--padding-desktop,120px); }
    .intro-section   { display:flex; justify-content:space-between; align-items:center; gap:40px; margin-bottom:60px; font-family:'Nunito Sans',sans-serif; }
    .intro-title     { font-family:'Poppins',sans-serif; font-weight:700; font-size:clamp(1.8rem,5vw,2.6rem); }
    .intro-text      { font-size:clamp(1rem,1.15vw,1.2rem); max-width:800px; line-height:1.7; }

    @media(max-width:850px){
      .content       { padding:30px var(--padding-mobile,28px); }
      .intro-section { flex-direction:column; text-align:center; gap:20px; }
      .intro-title,.intro-text { text-align:center; }
    }

    /* ---------- dashboard blocks ---------- */
    .dash-block      { margin-bottom:40px; position:relative; }
    .block-title     { font-family:'Poppins',sans-serif; font-weight:600; font-size:clamp(1.3rem,2.2vw,2rem); margin-bottom:20px; }

    /* pill switch (“tic‑tac” bar) */
    .pill-switch     { display:flex; background:#eee; border-radius:40px; overflow:hidden; width:max-content; margin:0 auto 28px; }
    .pill-switch button{ padding:8px 12px; border:none; background:transparent; font:600 0.9rem 'Nunito Sans',sans-serif; cursor:pointer; white-space:nowrap; }
    .pill-switch button.active{ background:#222; color:#fff; }

    /* SIZE row as fixed‑grid so centres never move */
    .planet-row{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:minmax(90px,1fr); /* constant slot width */
      gap:60px;
      justify-content:center;
      align-items:center;
      min-height:180px;                   /* row height fixed   */
    }
    .planet-icon{ object-fit:contain; }

    /* debug list */
    #size-debug{
      list-style:none; padding:0; margin:10px auto 0;
      max-width:280px; font:0.85rem/1.4 'Nunito Sans',sans-serif; text-align:center; opacity:0.7;
    }

    /* DISTANCE baseline */
    .dist-track      { position:relative; height:120px; }
    .dist-track::before{ content:""; position:absolute; top:50%; left:0; right:0; height:2px; background:#999; }
    .anchor          { width:46px; position:absolute; left:0; top:50%; transform:translate(-50%,-50%); }
    #dist-planets img{ width:36px; position:absolute; top:50%; transform:translate(-50%,-50%); }

    /* section divider */
    .section-divider { border:0; height:1px; background:#e5e5e5; margin:40px 0; }
  </style>
</head>

<body class="home">

  <!-- ▸ HEADER (unedited base markup) -->
  <header>
    <a class="brand" href="/index.html"><img src="/images/logo.png" alt="Hansen Space Logo"></a>
    <nav>
      <ul>
        <li><a href="/index.html">Home</a></li>
        <li><a href="/myjourney.html">My Journey</a></li>
        <li><a href="/photography.html">Photography</a></li>
        <li><a href="/articles">Articles</a></li>
        <li><a href="/tools.html" class="active">Tools</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
    <div class="menu-icon" onclick="toggleModal()">☰</div>
  </header>

  <div class="modal-backdrop" id="modal-backdrop" onclick="toggleModal()"></div>
  <div class="modal" id="modal">
    <a href="/index.html">Home</a>
    <a href="/myjourney.html">My Journey</a>
    <a href="/photography.html">Photography</a>
    <a href="/articles">Articles</a>
    <a href="/tools.html" class="active">Tools</a>
    <a href="/contact.html">Contact</a>
  </div>

  <!-- ▸ MAIN CONTENT -->
  <div class="content">

    <div class="intro-section">
      <h2 class="intro-title">PLANET DASHBOARD</h2>
      <p class="intro-text">A planetary dashboard for all of your needs.</p>
    </div>

    <!-- SIZE ---------------------------------------------------->
    <section id="size-sec" class="dash-block">
      <h3 class="block-title">SIZE</h3>

      <div class="pill-switch" id="size-mode">
        <button data-mode="true">true&nbsp;size</button>
        <button data-mode="apparent-earth" class="active">apparent&nbsp;size&nbsp;(Earth)</button>
        <button data-mode="apparent-sun">apparent&nbsp;size&nbsp;(Sun)</button>
      </div>

      <div class="planet-row" id="size-planets"></div>
      <ul id="size-debug"></ul>
    </section>

    <hr class="section-divider">

    <!-- DISTANCE ----------------------------------------------->
    <section id="dist-sec" class="dash-block">
      <h3 class="block-title">DISTANCE</h3>

      <div class="pill-switch" id="dist-mode">
        <button data-mode="sun">from Sun</button>
        <button data-mode="earth" class="active">from Earth</button>
        <button disabled>placeholder</button>
      </div>

      <div class="dist-track">
        <img id="dist-anchor" class="anchor" src="planets/earth.png" alt="earth anchor">
        <div id="dist-planets"></div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- placeholder for future section -->
    <section id="sky-sec" class="dash-block">
      <h3 class="block-title">IN THE SKY (coming soon)</h3>
      <p style="opacity:0.6">Feature under construction.</p>
    </section>
  </div>

  <!-- ▸ FOOTER (unedited) -->
  <footer>
    <div class="social-links">
      <a href="https://www.youtube.com/hansenspace" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube"></a>
      <a href="https://instagram.com/hansenspace" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram"></a>
      <a href="https://tiktok.com/@hansen_space" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok"></a>
    </div>
    <p>&copy; 2025 Hansen Space.</p>
  </footer>

  <!-- GLOBAL JS (modal toggle etc.) -->
  <script src="/scripts.js"></script>

  <!-- INLINE DASHBOARD LOGIC -->
  <script>
/* ---------- Static meta for each body ---------- */
const META = {
  mercury:{diameter:4879,  sma:0.387},
  venus:  {diameter:12104, sma:0.723},
  mars:   {diameter:6779,  sma:1.524},
  jupiter:{diameter:139820,sma:5.203},
  saturn: {diameter:116460,sma:9.537, ringFactor:1206/2737}, // disc / whole image
  uranus: {diameter:50724, sma:19.191},
  neptune:{diameter:49244, sma:30.068}
};
const IDS = Object.keys(META);

/* ---------- Runtime store with sensible fallbacks ---------- */
const planet = Object.fromEntries(
  IDS.map(id=>[id,{
    diameter    : META[id].diameter,
    distSunAU   : META[id].sma,
    distEarthAU : Math.abs(META[id].sma - 1) || 0.3   // simple offline diff
  }])
);

/* ---------- UI refs & state ---------- */
let sizeMode='apparent-earth', distMode='earth';
const sizeRow  = document.getElementById('size-planets');
const sizeDbg  = document.getElementById('size-debug');
const distRow  = document.getElementById('dist-planets');
const distAnch = document.getElementById('dist-anchor');

/* ---------- Pull live data (overwrites fallbacks) ----------- */
async function refresh(){
  try{
    const res  = await fetch('/netlify/functions/planetDashboard');
    if(!res.ok) throw new Error(res.status);
    const json = await res.json();
    const rows = json?.data?.table?.rows ?? [];
    rows.forEach(r=>{
      const id = r.entry.name.toLowerCase();
      if(!planet[id]) return;
      planet[id].distEarthAU = r.entry.distance.fromEarth.au;
      if(r.entry.distance.fromSun?.au) planet[id].distSunAU = r.entry.distance.fromSun.au;
    });
  }catch(e){ console.warn('dashboard fetch error',e.message); }
  drawAll();
}
refresh(); setInterval(refresh,600000);

/* ---------- DRAWERS ---------- */
function drawAll(){ drawSize(); drawDist(); }

function drawSize(){
  const AU_KM = 149_597_870.7;
  const maxPx = 160;                                       // fixed reference height

  const metric = id=>{
    if(sizeMode==='true') return planet[id].diameter;       // km
    const kmRad = planet[id].diameter/2;
    const AU    = sizeMode==='apparent-earth' ? planet[id].distEarthAU : planet[id].distSunAU;
    return 2*Math.atan(kmRad/(AU_KM*AU));                  // radians
  };
  const maxVal = Math.max(...IDS.map(metric));

  sizeRow.innerHTML = IDS.map(id=>{
    let value = metric(id);
    if(!isFinite(value)) value = 0;
    let px    = (value/maxVal)*maxPx;
    if(id==='saturn') px /= META.saturn.ringFactor;        // ring compensation
    px = Math.max(px,12);                                  // min size

    return `<img class="planet-icon" src="planets/${id}.png" alt="${id}"
                style="width:${px.toFixed(1)}px;height:${px.toFixed(1)}px;">`;
  }).join('');

  /* debug list */
  sizeDbg.innerHTML = IDS.map(id=>{
    if(sizeMode==='true'){
      return `<li>${id}: ${planet[id].diameter.toLocaleString()} km</li>`;
    }
    const arcsec = metric(id)*206264.806;
    return `<li>${id}: ${arcsec.toFixed(1)}″</li>`;
  }).join('');
}

function drawDist(){
  const anchorSun = distMode==='sun';
  distAnch.src = anchorSun ? 'planets/sun.png':'planets/earth.png';
  distAnch.alt = anchorSun ? 'sun anchor':'earth anchor';

  const dist = id=> anchorSun ? planet[id].distSunAU : planet[id].distEarthAU;
  const maxD = Math.max(...IDS.map(dist));

  distRow.innerHTML = IDS.map(id=>{
    let pct = (dist(id)/maxD)*100;
    if(!isFinite(pct)) pct = 0;
    return `<img src="planets/${id}.png" alt="${id}" title="${dist(id).toFixed(3)} AU"
                style="left:${pct}%;">`;
  }).join('');
}

/* ---------- Button listeners ---------- */
document.querySelectorAll('#size-mode button').forEach(btn=>btn.onclick=()=>{
  if(btn.classList.contains('active')) return;
  sizeMode = btn.dataset.mode;
  btn.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  drawSize();
});
document.querySelectorAll('#dist-mode button').forEach(btn=>btn.onclick=()=>{
  if(btn.classList.contains('active')) return;
  distMode = btn.dataset.mode;
  btn.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  drawDist();
});
  </script>
</body>
</html>

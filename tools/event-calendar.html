<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cosmic Event Calendar - Hansen Space</title>
  
  <!-- Standard Header/Footer styles -->
  <link rel="stylesheet" href="../styles.css">
  
  <style>
    /* ---------------------- Layout and Basic Styling ---------------------- */
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      width: 100%;
      box-sizing: border-box;
      position: static;
      z-index: 1000;
    }
    /* Navigation Buttons */
    #backToTop, .toTodayButton {
      position: fixed;
      padding: 6px 10px;
      background: #fff;
      border: 1px solid #000;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: opacity 0.3s ease, left 0.3s ease;
      opacity: 0;
      visibility: hidden;
      z-index: 1200;
      white-space: nowrap;
    }
    #backToTop {
      top: calc(100px + 10px);
      left: 50%;
      transform: translateX(-50%);
    }
    #goToTodayUp { top: calc(100px + 10px); }
    #goToTodayDown {
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }
    main {
      flex: 1;
      position: relative;
      overflow-y: auto;
      background: #fff;
      padding-top: 10px;
    }
    /* ---------------------- Calendar Header and Key ---------------------- */
    #calendar-header {
      padding: 40px 20px 20px 20px;
      max-width: 1000px;
      margin: 0 auto;
      text-align: center;
    }
    #calendar-header h1 { margin: 0 0 10px; font-size: 2em; font-family: 'Moon Bold', sans-serif; }
    #calendar-header p { margin: 0 0 10px; font-size: 1.1em; font-family: 'Moon Light', sans-serif; }
    #calendar-key {
      margin: 0 auto 20px auto;
      max-width: 800px;
    }
    #calendar-key table { border-collapse: collapse; width: 100%; }
    #calendar-key th, #calendar-key td {
      padding: 4px 8px; text-align: left; font-family: 'Moon Light', sans-serif;
      font-size: 0.9em; border: 1px solid #ddd;
    }
    #calendar-key th { background: #f0f0f0; }
    #calendar-key th.showInScroll { width: 120px; }
    /* ---------------------- Calendar List Styling ---------------------- */
    #contentArea {
      list-style: none; margin: 0 auto; padding: 20px; max-width: 1000px;
    }
    .day-box, .month-label {
      height: 40px; line-height: 40px; padding: 0 10px; font-size: 14px;
      background: #fff; white-space: nowrap; overflow: visible; margin: 0; box-sizing: border-box; position: relative;
    }
    .day-box { border-bottom: 1px solid #ccc; }
    .month-label {
      font-size: 12px; font-weight: bold; background: #eee; color: #666; padding-left: 10px;
    }
    .today-box { background: #a4dcf8; color: #000; padding-right: 60px; }
    .today-label {
      position: absolute; right: 4px; top: 50%; transform: translateY(-50%);
      font-size: 12px; font-weight: bold; padding: 2px 6px;
    }
    /* ---------------------- Cosmic Icons and Tooltips ---------------------- */
    .cosmic-icon {
      display: inline-block;
      width: 30px;
      height: 30px;
      margin-left: 5px;
      vertical-align: middle;
      position: relative;
      cursor: pointer;
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 50%;
    }
    .cosmic-icon::after {
      content: attr(data-tooltip);
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translate(-50%, 5px);
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 3px 6px;
      font-size: 12px;
      border-radius: 3px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, transform 0.2s ease;
      pointer-events: none;
      z-index: 1200;
    }
    .cosmic-icon:hover::after {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, 0);
    }
    .legend-icon::after { display: none; }
    /* ---------------------- Custom Scrollbar ---------------------- */
    #custom-scrollbar {
      position: fixed;
      right: 0;
      width: 30px;
      background: #eee;
      z-index: 1100;
      cursor: pointer;
    }
    #scroll-indicator {
      position: absolute;
      left: 0;
      right: 0;
      height: 4px;
      background: #999;
      top: 0;
      z-index: 1300;
    }
    #scroll-markers {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      pointer-events: none;
      background: transparent;
    }
    .scroll-marker {
      position: absolute;
      left: 0;
      width: 100%;
      height: 3px;
      pointer-events: auto;
      border-radius: 2px;
      border: none;
      box-shadow: none;
    }
    .today-marker { background: #a6dcf7; z-index: 1250; }
    /* ---------------------- Checkbox Replacement ---------------------- */
    .scroll-toggle:checked { accent-color: var(--checkbox-color); }
    /* #backButton {
      position: sticky;
      top: 0;
      left: 10px;
      z-index: 1100;
      background: #fff;
      border: 1px solid #000;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      text-align: center;
      line-height: 0;
      font-size: 18px;
      color: #000;
      cursor: pointer;
      padding: 0;
    } */
  </style>
  <script src="/scripts.js"></script>
  <!-- Load Clusterize.js -->
  <script src="https://cdn.jsdelivr.net/npm/clusterize.js@0.18.1/clusterize.min.js" defer></script>
  
  <!-- Precomputed Cosmic Events Data -->
  <script>
    // This variable should be populated with the JSON data produced by the generator.
    const precomputedCosmicEvents = []

    const cosmicEventsByDate = {};
    precomputedCosmicEvents.forEach(event => {
      if (!cosmicEventsByDate[event.date]) {
        cosmicEventsByDate[event.date] = [];
      }
      cosmicEventsByDate[event.date] = cosmicEventsByDate[event.date].concat(event.types);
    });
  </script>
  
  <!-- Astronomy Engine if needed -->
  <script src="https://cdn.jsdelivr.net/gh/cosinekitty/astronomy@master/source/js/astronomy.browser.js"></script>
  
</head>
<body>
  <header>
    <a class="brand" href="/index.html">
      <img src="/images/logo.png" alt="Hansen Space Logo">
    </a>
    <nav>
      <ul>
        <li><a href="/index.html">Home</a></li>
        <li><a href="/myjourney.html">My Journey</a></li>
        <li><a href="/photography.html">Photography</a></li>
        <li><a href="/articles">Articles</a></li>
        <li><a href="/tools.html">Tools</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
    <div class="menu-icon" onclick="toggleModal()">☰</div>
  </header>
  
  <div class="modal-backdrop" id="modal-backdrop" onclick="toggleModal()"></div>
  <div class="modal" id="modal">
    <a href="/index.html">Home</a>
    <a href="/myjourney.html">My Journey</a>
    <a href="/photography.html">Photography</a>
    <a href="/articles">Articles</a>
    <a href="/tools.html">Tools</a>
    <a href="/contact.html">Contact</a>
  </div>
  
  <!-- Navigation Buttons -->
  <div id="backToTop" onclick="scrollToTop()">Back to Top ↑</div>
  <div id="goToTodayUp" class="toTodayButton" onclick="scrollToToday()">Today ↑</div>
  <div id="goToTodayDown" class="toTodayButton" onclick="scrollToToday()">Today ↓</div>
  
  <main id="main-scroll">
    <!-- <button id="backButton" onclick="location.href='../tools.html'">&#8592;</button> -->
    <div id="calendar-header">
      <h1>Cosmic Event Calendar</h1>
      <p>A utility for visualizing the dates of cosmic events.</p>
      <div id="calendar-key">
        <table>
          <thead>
            <tr>
              <th style="width:40px;">Icon</th>
              <th>Event</th>
              <th class="showInScroll">Show in Scrollbar</th>
            </tr>
          </thead>
          <tbody>
            <!-- Original events from Astronomy Engine -->
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://marketplace.canva.com/MADCSJcoCFU/1/thumbnail_large-1/canva-full-moon-isolated-MADCSJcoCFU.png'); background-size: cover;"></span>
              </td>
              <td>Full Moon</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="fullmoon"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://cdn.pixabay.com/photo/2013/07/13/11/22/sun-158027_1280.png'); background-size: 150%; background-position: calc(50% + 2px) calc(50% + 2px);"></span>
              </td>
              <td>Venus Maximum Brightness</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="venusmaxbrightness"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://www.aquinas.edu/foster-planet-walk/images/mars.png'); background-size: cover;"></span>
              </td>
              <td>Mars Opposition</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="marsopposition"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://www.solarsystemscope.com/spacepedia/images/handbook/renders/jupiter.png'); background-size: cover;"></span>
              </td>
              <td>Jupiter Opposition</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="jupiteropposition"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://www.coolaboo.com/wp-content/uploads/2019/03/saturn.png'); background-size: 80%; background-position: center center;"></span>
              </td>
              <td>Saturn Opposition</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="saturnopposition"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://imageio.forbes.com/specials-images/imageserve/62977622bbcd08eda96222a0/The-transit-of-Venus-on-June-5--2012-from-Mauna-Kea-volcano--Hawaii-captured-by/960x0.jpg'); background-size: 105%; background-position: center center;"></span>
              </td>
              <td>Venus Transit</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="venustransit"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://c02.purpledshub.com/uploads/sites/48/2019/02/MerTran-Composite-corrected03-d50545a.jpg'); background-size: calc(1000%); background-position: calc(50% - 72px) calc(50% - 100px);"></span>
              </td>
              <td>Mercury Transit</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="mercurytransit"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://www.roanoke.edu/images/News/2024/2024%20Eclipse/Hanke%20Eclipse%203.png'); background-size: 640%; background-position: calc(50% - 15px) calc(50% + 17px);"></span>
              </td>
              <td>Partial Solar Eclipse</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="partialsolareclipse"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://digitaleclipse.io/wp-content/uploads/2022/03/Total-Eclipse.png'); background-size: cover;"></span>
              </td>
              <td>Total Solar Eclipse</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="totalsolareclipse"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://png.pngtree.com/png-clipart/20230120/ourmid/pngtree-total-solar-eclipse-realistic-illustration-png-image_6561454.png'); background-size: cover;"></span>
              </td>
              <td>Annular Solar Eclipse</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="annularsolareclipse"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://griffithobservatory.org/wp-content/uploads/2021/01/claudio-testa-sIglh0SISjo-unsplash-1600x800.jpg'); background-size: 500%; background-position: calc(50% - 38px) center;"></span>
              </td>
              <td>Partial Lunar Eclipse</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="partiallunareclipse"></td>
            </tr>
            <tr>
              <td>
                <span class="cosmic-icon legend-icon" style="background-image: url('https://griffithobservatory.org/wp-content/uploads/2021/01/claudio-testa-sIglh0SISjo-unsplash-1600x800.jpg'); background-size: 500%; background-position: calc(50% + 37px) center;"></span>
              </td>
              <td>Total Lunar Eclipse</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="totallunareclipse"></td>
            </tr>
            <!-- Aggregated Mutual Planetary Occultation row for the key -->
            <tr>
              <td>
                <!-- PLACEHOLDER URL: Adjust this to your aggregated mutual events image -->
                <span class="cosmic-icon legend-icon" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8JX6leYmBofrqX0VQsgRZAhdR5Sg91ET4_Q&s'); background-size: 120%; background-position: calc(50% + 0px) calc(50% + 0px);"></span>
              </td>
              <td>Mutual Planetary Occultation</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="mutualplanetary"></td>
            </tr>
            <!-- Halley's Comet row in the key -->
            <tr>
              <td>
                <!-- PLACEHOLDER URL: Adjust this to your Halley's comet image -->
                <span class="cosmic-icon legend-icon" style="background-image: url('https://cdn.mos.cms.futurecdn.net/zzCKzkAndgXbTKNoKCUqu9-1200-80.jpg'); background-size: 150%; background-position: calc(50% - 5px) calc(50% - 1px);"></span>
              </td>
              <td>Halley's Comet Perihelion</td>
              <td><input type="checkbox" class="scroll-toggle" data-event="halleys_comet_perihelion"></td>
            </tr>
            <!-- Note: The three "Other" events are not added to the key -->
          </tbody>
        </table>
        <p style="font-style: italic; margin-top:8px; font-size:0.85em;">
          Use the scrollbar on the right to jump to a future date.
        </p>
      </div>
    </div>
    <ul id="contentArea">
      <!-- Clusterize.js will insert rows here -->
    </ul>
  </main>
  
  <div id="custom-scrollbar">
    <div id="scroll-indicator"></div>
    <div id="scroll-markers"></div>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      /* ------------------ Define General Mutual Occultation Images ------------------ */
      // These two variables hold the general images for mutual occultations.
      // Adjust these URLs to point to your images.
      const mutualTotalIcon = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8JX6leYmBofrqX0VQsgRZAhdR5Sg91ET4_Q&s";     // PLACEHOLDER URL for total occultations.
      const mutualPartialIcon = "https://www.bogan.ca/astro/occultations/oclt2079.gif";   // PLACEHOLDER URL for partial occultations.
      // Default crop settings for mutual images (both key and calendar).
      const mutualTotalCrop = { backgroundSize: "120%", backgroundPosition: "calc(50% + 0px) calc(50% + 0px)" };
      const mutualPartialCrop = { backgroundSize: "400%", backgroundPosition: "calc(50% - 2px) calc(50% + 0px)" };

      // Base mapping for non-mutual events and for the key's aggregated mutual checkbox.
      const eventMapping = {
        "fullmoon": {
          icon: "https://marketplace.canva.com/MADCSJcoCFU/1/thumbnail_large-1/canva-full-moon-isolated-MADCSJcoCFU.png",
          tooltip: "Full Moon",
          markerColor: "#baf1ff"
        },
        "venusmaxbrightness": {
          icon: "https://cdn.pixabay.com/photo/2013/07/13/11/22/sun-158027_1280.png",
          tooltip: "Venus Maximum Brightness",
          crop: {
            backgroundPosition: "calc(50% + 2px) calc(50% + 2px)",
            backgroundSize: "150%"
          },
          markerColor: "#fffcba"
        },
        "marsopposition": {
          icon: "https://www.aquinas.edu/foster-planet-walk/images/mars.png",
          tooltip: "Mars Opposition",
          markerColor: "#b84930"
        },
        "jupiteropposition": {
          icon: "https://www.solarsystemscope.com/spacepedia/images/handbook/renders/jupiter.png",
          tooltip: "Jupiter Opposition",
          markerColor: "#edb077"
        },
        "saturnopposition": {
          icon: "https://www.coolaboo.com/wp-content/uploads/2019/03/saturn.png",
          tooltip: "Saturn Opposition",
          crop: {
            backgroundPosition: "center center",
            backgroundSize: "80%"
          },
          markerColor: "#f5ca5d"
        },
        "venustransit": {
          icon: "https://imageio.forbes.com/specials-images/imageserve/62977622bbcd08eda96222a0/The-transit-of-Venus-on-June-5--2012-from-Mauna-Kea-volcano--Hawaii-captured-by/960x0.jpg",
          tooltip: "Venus Transit",
          crop: {
            backgroundPosition: "center center",
            backgroundSize: "105%"
          },
          markerColor: "#F5DEB3"
        },
        "mercurytransit": {
          icon: "https://c02.purpledshub.com/uploads/sites/48/2019/02/MerTran-Composite-corrected03-d50545a.jpg",
          tooltip: "Mercury Transit",
          crop: {
            backgroundPosition: "calc(50% - 72px) calc(50% - 100px)",
            backgroundSize: "1000%"
          },
          markerColor: "#C0C0C0"
        },
        "partialsolareclipse": {
          icon: "https://www.roanoke.edu/images/News/2024/2024%20Eclipse/Hanke%20Eclipse%203.png",
          tooltip: "Partial Solar Eclipse",
          crop: {
            backgroundPosition: "calc(50% - 15px) calc(50% + 17px)",
            backgroundSize: "640%"
          },
          markerColor: "#fa5102"
        },
        "totalsolareclipse": {
          icon: "https://digitaleclipse.io/wp-content/uploads/2022/03/Total-Eclipse.png",
          tooltip: "Total Solar Eclipse",
          markerColor: "#000000"
        },
        "annularsolareclipse": {
          icon: "https://png.pngtree.com/png-clipart/20230120/ourmid/pngtree-total-solar-eclipse-realistic-illustration-png-image_6561454.png",
          tooltip: "Annular Solar Eclipse",
          markerColor: "#fad102"
        },
        "partiallunareclipse": {
          icon: "https://griffithobservatory.org/wp-content/uploads/2021/01/claudio-testa-sIglh0SISjo-unsplash-1600x800.jpg",
          tooltip: "Partial Lunar Eclipse",
          crop: {
            backgroundPosition: "calc(50% - 38px) center",
            backgroundSize: "500%"
          },
          markerColor: "#FFB6C1"
        },
        "totallunareclipse": {
          icon: "https://griffithobservatory.org/wp-content/uploads/2021/01/claudio-testa-sIglh0SISjo-unsplash-1600x800.jpg",
          tooltip: "Total Lunar Eclipse",
          crop: {
            backgroundPosition: "calc(50% + 37px) center",
            backgroundSize: "500%"
          },
          markerColor: "#8B0000"
        },
        // Mapping for Halley's events.
        "halleys_comet_perihelion": {
          // PLACEHOLDER URL: Adjust this to point to your Halley's comet image.
          icon: "https://cdn.mos.cms.futurecdn.net/zzCKzkAndgXbTKNoKCUqu9-1200-80.jpg",
          crop: { backgroundSize: "150%", backgroundPosition: "calc(50% - 5px) calc(50% - 1px)" },
          tooltip: "Halley's Comet Perihelion",
          markerColor: "#FF4500"
        },
        // Mappings for Other events (not shown in key)
        "other_asteroid_apophis_flyby": {
          // PLACEHOLDER URL: Adjust this to point to your Asteroid Apophis flyby image.
          icon: "https://images.theconversation.com/files/628801/original/file-20241029-15-izp6xk.jpg?ixlib=rb-4.1.0&q=45&auto=format&w=754&fit=clip",
          crop: { backgroundSize: "200%", backgroundPosition: "calc(50% + 0px) calc(50% + 0px)" },
          tooltip: "Asteroid Apophis flyby",
          markerColor: "#00FF00"
        },
        "other_asteroid_2024YR4_flyby": {
          // PLACEHOLDER URL: Adjust this to point to your Asteroid 2024 YR4 flyby image.
          icon: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUn9omLfbm-ByQoJnapuG345x1MUBu7NdVGA&s",
          crop: { backgroundSize: "225%", backgroundPosition: "calc(50% + 0px) calc(50% + 0px)" },
          tooltip: "Asteroid 2024 YR4 flyby",
          markerColor: "#00FF00"
        },
        "other_polaris_furthest_north": {
          // PLACEHOLDER URL: Adjust this to point to your Polaris furthest north image.
          icon: "https://www.star-facts.com/wp-content/uploads/2019/09/Polaris-North-Star.webp",
          crop: { backgroundSize: "300%", backgroundPosition: "calc(50% + 0px) calc(50% + 0px)" },
          tooltip: "Polaris appears furthest north",
          markerColor: "#00FF00"
        },
        // Aggregated mapping for the key's mutual events checkbox.
        "mutualplanetary": {
          // PLACEHOLDER URL: Adjust this to point to your aggregated mutual event image.
          icon: "placeholder_mutual_aggregated.png",
          crop: { backgroundSize: "100%", backgroundPosition: "calc(50% + 0px) calc(50% + 0px)" },
          tooltip: "Mutual Planetary Occultation",
          markerColor: "#FF00FF"
        }
      };

      // Helper function to capitalize the first letter.
      function capitalize(s) {
        return s.charAt(0).toUpperCase() + s.slice(1);
      }

      // Helper function to get a mapping for a mutual planetary event.
      // Expected tag format: "mutual_YYYYMMDD_<combo>" where <combo> ends with "partial" or "total"
      // and the remaining part is the concatenation of the front planet and back planet names.
      // NOTE: BACK AND FRONT ARE BACKWARDS
      function getMappingForMutual(type) {
        // Check if we already have a mapping for this exact tag.
        if (eventMapping[type]) return eventMapping[type];
        const parts = type.split("_");
        if (parts.length < 3) return null;
        const combo = parts[2]; // e.g. "marsjupitertotal" or "jupitervenuspartial"
        let occultSuffix = null;
        if (combo.endsWith("partial")) {
          occultSuffix = "partial";
        } else if (combo.endsWith("total")) {
          occultSuffix = "total";
        } else {
          return null; // Invalid format.
        }
        // Remove the suffix from the combo.
        const comboBase = combo.substring(0, combo.length - occultSuffix.length);
        const planets = ["mercury", "venus", "earth", "mars", "jupiter", "saturn", "uranus", "neptune", "pluto"];
        let front = "", back = "";
        for (let planet of planets) {
          if (comboBase.startsWith(planet)) {
            front = planet;
            back = comboBase.substring(planet.length);
            break;
          }
        }
        if (!front || !planets.includes(back)) return null;
        // Build tooltip with the proper wording.
        const tooltip = capitalize(back) + " " + (occultSuffix === "partial" ? "partially occults" : "occults") + " " + capitalize(front);
        // Use the two general images defined above.
        const mapping = {
          icon: (occultSuffix === "partial" ? mutualPartialIcon : mutualTotalIcon),
          crop: (occultSuffix === "partial" ? mutualPartialCrop : mutualTotalCrop),
          tooltip: tooltip,
          markerColor: "#FF00FF"
        };
        // Save the mapping for future use.
        eventMapping[type] = mapping;
        return mapping;
      }

      // Replace native checkboxes with custom divs.
      document.querySelectorAll(".scroll-toggle").forEach(input => {
        input.style.display = "none";
        const customCheckbox = document.createElement("div");
        customCheckbox.className = "custom-checkbox";
        customCheckbox.style.width = "14px";
        customCheckbox.style.height = "14px";
        customCheckbox.style.border = "2px solid black";
        customCheckbox.style.display = "inline-block";
        customCheckbox.style.cursor = "pointer";
        customCheckbox.style.verticalAlign = "middle";
        customCheckbox.style.boxSizing = "border-box";
        customCheckbox.addEventListener("click", function() {
          input.checked = !input.checked;
          if (input.checked) {
            customCheckbox.style.backgroundColor = eventMapping[input.getAttribute("data-event")].markerColor;
            customCheckbox.textContent = "×";
            customCheckbox.style.color = "black";
            customCheckbox.style.fontSize = "12px";
            customCheckbox.style.textAlign = "center";
            customCheckbox.style.lineHeight = "14px";
          } else {
            customCheckbox.style.backgroundColor = "transparent";
            customCheckbox.textContent = "";
          }
          input.dispatchEvent(new Event("change"));
        });
        input.parentNode.insertBefore(customCheckbox, input);
      });

      document.querySelectorAll(".scroll-toggle").forEach(checkbox => {
        const eventType = checkbox.getAttribute("data-event");
        if (eventMapping[eventType]) {
          checkbox.style.setProperty("--checkbox-color", eventMapping[eventType].markerColor);
        }
      });

      function formatDate(date) {
        const y = date.getFullYear();
        const m = (date.getMonth() + 1).toString().padStart(2, '0');
        const d = date.getDate().toString().padStart(2, '0');
        return `${y}-${m}-${d}`;
      }

      // Generate calendar rows: one for each day.
      const startDate = new Date("2025-01-01T00:00:00");
      const endDate = new Date("3000-12-31T23:59:59");
      const totalDays = (endDate - startDate) / 86400000;
      
      const todayStr = formatDate(new Date());
      const rows = [];
      let currentDate = new Date(startDate);
      while (currentDate <= endDate) {
        const dateStr = formatDate(currentDate);
        // Optionally skip a specific date.
        if (dateStr === "2024-12-31") {
          currentDate = new Date(currentDate.getTime() + 86400000);
          continue;
        }
        if (currentDate.getDate() === 1) {
          rows.push(`<li class="month-label">${currentDate.toLocaleString('default', { month: 'long' })} ${currentDate.getFullYear()}</li>`);
        }
        let iconsHTML = "";
        if (cosmicEventsByDate[dateStr]) {
          cosmicEventsByDate[dateStr].forEach(type => {
            let mapping;
            if (type.startsWith("mutual_")) {
              mapping = getMappingForMutual(type);
            } else {
              mapping = eventMapping[type];
            }
            if (mapping) {
              iconsHTML += `<span class="cosmic-icon" style="background-image: url('${mapping.icon}');` +
                (mapping.crop ? ` background-position: ${mapping.crop.backgroundPosition}; background-size: ${mapping.crop.backgroundSize};` : '') +
                `" data-tooltip="${mapping.tooltip}"></span>`;
            }
          });
        }
        if (dateStr === todayStr) {
          rows.push(`<li class="day-box today-box" data-date="${dateStr}">${dateStr}${iconsHTML}<span class="today-label">today</span></li>`);
        } else {
          rows.push(`<li class="day-box" data-date="${dateStr}">${dateStr}${iconsHTML}</li>`);
        }
        currentDate = new Date(currentDate.getTime() + 86400000);
      }
      
      console.log("Generated rows:", rows.length);
      
      new Clusterize({
        rows: rows,
        scrollId: 'main-scroll',
        contentId: 'contentArea',
        rows_in_block: 100,
        blocks_in_cluster: 100
      });
      
      // Build scroll markers.
      function buildMarkers() {
        const scrollMarkersContainer = document.getElementById("scroll-markers");
        scrollMarkersContainer.innerHTML = "";
        const calibrationDays = 10;
        const checkboxes = document.querySelectorAll(".scroll-toggle:checked");
        const eventsToShow = Array.from(checkboxes).map(cb => cb.getAttribute("data-event"));
        Object.keys(cosmicEventsByDate).forEach(dateStr => {
          const events = cosmicEventsByDate[dateStr];
          events.forEach(eventType => {
            // For mutual events, if the aggregated checkbox ("mutualplanetary") is checked, show marker.
            if (( !eventType.startsWith("mutual_") && eventsToShow.includes(eventType)) ||
                (eventType.startsWith("mutual_") && eventsToShow.includes("mutualplanetary"))) {
              let mapping;
              if (eventType.startsWith("mutual_")) {
                mapping = getMappingForMutual(eventType);
              } else {
                mapping = eventMapping[eventType];
              }
              if (mapping) {
                const eventDate = new Date(dateStr + "T00:00:00");
                const daysFromStart = (eventDate - startDate) / 86400000;
                const fraction = daysFromStart / totalDays;
                const marker = document.createElement("div");
                marker.className = "scroll-marker";
                marker.style.top = (fraction * 100) + "%";
                marker.style.height = "5px";
                marker.style.background = mapping.markerColor;
                marker.addEventListener("click", function(e) {
                  e.stopPropagation();
                  const targetDayFraction = (daysFromStart + calibrationDays) / totalDays;
                  const mainScroll = document.getElementById("main-scroll");
                  const newScrollTop = targetDayFraction * (mainScroll.scrollHeight - mainScroll.clientHeight);
                  mainScroll.scrollTop = newScrollTop;
                  updateButtons();
                });
                scrollMarkersContainer.appendChild(marker);
              }
            }
          });
        });
        // Add marker for today.
        const todayDate = new Date(todayStr + "T00:00:00");
        const daysFromStartToday = (todayDate - startDate) / 86400000;
        const fractionToday = daysFromStartToday / totalDays;
        const todayMarker = document.createElement("div");
        todayMarker.className = "scroll-marker today-marker";
        todayMarker.style.top = (fractionToday * 100) + "%";
        todayMarker.style.height = "5px";
        todayMarker.addEventListener("click", function(e) {
          e.stopPropagation();
          scrollToToday();
        });
        document.getElementById("scroll-markers").appendChild(todayMarker);
      }
      
      buildMarkers();
      
      const toggles = document.querySelectorAll(".scroll-toggle");
      toggles.forEach(toggle => {
        toggle.addEventListener("change", buildMarkers);
      });
      
      // Position custom scrollbar just under header.
      const headerElem = document.getElementById("header");
      const scrollbar = document.getElementById("custom-scrollbar");
      const headerHeight = headerElem.offsetHeight;
      scrollbar.style.top = headerHeight + "px";
      scrollbar.style.height = "calc(100vh - " + headerHeight + "px)";
      
      // Update button positions based on header height.
      document.getElementById("backToTop").style.top = (headerHeight + 10) + "px";
      document.getElementById("goToTodayUp").style.top = (headerHeight + 10) + "px";
    });
  </script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const mainScroll = document.getElementById("main-scroll");
      const scrollbar = document.getElementById("custom-scrollbar");
      const indicator = document.getElementById("scroll-indicator");
      
      mainScroll.addEventListener("scroll", function() {
        const scrollTop = mainScroll.scrollTop;
        const scrollHeight = mainScroll.scrollHeight - mainScroll.clientHeight;
        const scrollPercent = scrollTop / scrollHeight;
        const scrollbarHeight = scrollbar.clientHeight;
        const indicatorTop = scrollPercent * scrollbarHeight;
        indicator.style.top = indicatorTop + "px";
        updateButtons();
      });
      
      scrollbar.addEventListener("click", function(e) {
        const rect = scrollbar.getBoundingClientRect();
        const clickY = e.clientY - rect.top;
        const scrollPercent = clickY / scrollbar.clientHeight;
        const newScrollTop = scrollPercent * (mainScroll.scrollHeight - mainScroll.clientHeight);
        mainScroll.scrollTop = newScrollTop;
        updateButtons();
      });
    });
    
    function scrollToTop() {
      document.getElementById("main-scroll").scrollTo({
        top: 0,
        behavior: "smooth"
      });
    }
    function scrollToToday() {
      const mainScroll = document.getElementById("main-scroll");
      const todayStr = new Date().toISOString().slice(0,10);
      let todayRow = document.querySelector('.day-box[data-date="' + todayStr + '"]');
      if (todayRow) {
        const targetScrollTop = todayRow.offsetTop - (mainScroll.clientHeight / 2) + (todayRow.clientHeight / 2);
        mainScroll.scrollTo({
          top: targetScrollTop,
          behavior: "smooth"
        });
      } else {
        const startDate = new Date("2025-01-01T00:00:00");
        const endDate = new Date("3000-12-31T23:59:59");
        const totalDays = (endDate - startDate) / 86400000;
        const todayDate = new Date(todayStr + "T00:00:00");
        const dayDiff = (todayDate - startDate) / 86400000;
        const fraction = dayDiff / totalDays;
        const newScrollTop = fraction * (document.getElementById("main-scroll").scrollHeight - document.getElementById("main-scroll").clientHeight);
        mainScroll.scrollTo({
          top: newScrollTop,
          behavior: "smooth"
        });
      }
    }
    
    function updateButtons() {
      const mainScroll = document.getElementById("main-scroll");
      const header = document.getElementById("header");
      const backToTop = document.getElementById("backToTop");
      const toTodayUp = document.getElementById("goToTodayUp");
      const toTodayDown = document.getElementById("goToTodayDown");
      const scrollTop = mainScroll.scrollTop;
      const mainHeight = mainScroll.clientHeight;
      const todayRow = document.querySelector('.day-box[data-date="' + new Date().toISOString().slice(0,10) + '"]');
      const todayOffset = todayRow.offsetTop;
      const todayHeight = todayRow.clientHeight;
      
      toTodayUp.style.opacity = "0";
      toTodayUp.style.visibility = "hidden";
      toTodayDown.style.opacity = "0";
      toTodayDown.style.visibility = "hidden";
      
      if (scrollTop < 50) {
        backToTop.style.opacity = "0";
        backToTop.style.visibility = "hidden";
      } else {
        backToTop.style.opacity = "1";
        backToTop.style.visibility = "visible";
      }
      
      const isTodayVisible = (todayOffset >= scrollTop && (todayOffset + todayHeight) <= (scrollTop + mainHeight));
      const isTodayAbove = ((todayOffset + todayHeight) < scrollTop);
      const isTodayBelow = (todayOffset > (scrollTop + mainHeight));
      
      if (isTodayVisible) {
        backToTop.style.left = "50%";
        backToTop.style.transform = "translateX(-50%)";
      } else if (isTodayAbove) {
        backToTop.style.left = "calc(50% - 110px)";
        backToTop.style.transform = "none";
        toTodayUp.style.left = "calc(50% + 20px)";
        toTodayUp.style.opacity = "1";
        toTodayUp.style.visibility = "visible";
      } else if (isTodayBelow) {
        backToTop.style.left = "50%";
        backToTop.style.transform = "translateX(-50%)";
        toTodayDown.style.opacity = "1";
        toTodayDown.style.visibility = "visible";
      }
    }
    
    document.addEventListener("DOMContentLoaded", function () {
      const mainScroll = document.getElementById("main-scroll");
      mainScroll.addEventListener("scroll", updateButtons);
      updateButtons();
    });
  </script>
  
</body>
</html>

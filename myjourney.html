<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Journey – Hansen Space</title>
    <link rel="stylesheet" href="parallax.css">
    <link rel="stylesheet" href="/styles.css">
    <style>
        /* All page-specific styles remain untouched */
        .journey-group:not(:first-child) { margin-top: 200px; }
        @media (max-width: 600px) { .journey-group:not(:first-child) { margin-top: 250px; } }
        .star-layer { background-size: auto !important; background-repeat: repeat !important; }
        @media (min-width: 1001px) { #layer4, #layer6, #layer8 { background-size: 100% auto !important; background-repeat: repeat-x !important; } }
        .star-layer:not(#layer9) { background-color: transparent; }
        footer { position: relative; z-index: 101; }
        .content { position: relative; z-index: 200; background: transparent; }
        .journey-container { position: relative; z-index: 210; width: 100%; max-width: 1000px; margin: 0 auto; padding: 40px; box-sizing: border-box; }
        .group-text { background: rgba(0, 0, 0, 0.8); border: 1px solid #fff; padding: 20px; border-radius: 8px; color: white; box-sizing: border-box; }
        .date-title { font-family: 'Poppins', sans-serif; font-size: clamp(1rem, 1.2vw, 1.3rem); font-weight: 600; display: block; margin-bottom: 20px; }
        .group-text p { font-family: 'Nunito Sans', sans-serif; font-size: clamp(1rem, 1.2vw, 1.2rem); margin-top: 10px; margin-bottom: 0; }
        .group-grid { display: grid; grid-gap: 20px; margin-top: 20px; width: 90%; max-width: 600px; margin-left: auto; margin-right: auto; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .yt-container, .shorts-container { display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 600px; margin: 20px auto 0 auto; }
        .yt-bottom, .shorts-bottom { display: grid; grid-gap: 10px; grid-template-columns: repeat(3, 1fr); }
        .shorts-top { display: flex; flex-wrap: wrap; gap: 10px; }
        .spring-grid { display: grid; grid-gap: 20px; margin-top: 20px; width: 90%; max-width: 600px; margin-left: auto; margin-right: auto; grid-template-columns: 1fr; }
        .group-grid img, .yt-container img, .shorts-container img, .spring-grid img { width: 100%; display: block; object-fit: cover; border: 2px solid #fff; border-radius: 8px; box-sizing: border-box; }
        .flash { animation: flash 0.5s ease-out; }
        @keyframes flash { 0% { transform: scale(1); filter: brightness(1); } 50% { transform: scale(1.1); filter: brightness(2); } 100% { transform: scale(1); filter: brightness(1); } }
        .scroll-indicator-container { position: relative; z-index: 300; height: 600px; display: flex; justify-content: center; align-items: center; }
        .scroll-indicator { font-family: 'Poppins', sans-serif; font-weight: 700; font-size: clamp(2rem, 3vw, 2.5rem); color: white; }
        @media (max-width: 600px) { .journey-container { padding: 20px; } .group-text { padding: 15px; } .group-grid { grid-gap: 15px; max-width: 80%; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); } .yt-container, .shorts-container, .spring-grid { max-width: 80%; } }
        .group-text a.scroll-link, .group-text a.external-link { color: #66ccff; text-decoration: underline; }
    </style>
</head>
<body>
    <div class="modal-backdrop" id="modal-backdrop" onclick="toggleModal()"></div>
    <div class="modal" id="modal"><a href="/index.html">Home</a><a href="/myjourney.html" class="active">My Journey</a><a href="/photography.html">Photography</a><a href="/articles">Articles</a><a href="/tools.html">Tools</a><a href="/contact.html">Contact</a></div>
    <header><div class="header-inner-container content-limiter"><a class="brand" href="/index.html"><img src="/images/logo.png" alt="Hansen Space Logo" onerror="this.src='https://placehold.co/200x50/1c1c1c/FFFFFF?text=Hansen+Space'; this.onerror=null;"></a><nav><ul><li><a href="/index.html">Home</a></li><li><a href="/myjourney.html" class="active">My Journey</a></li><li><a href="/photography.html">Photography</a></li><li><a href="/articles">Articles</a></li><li><a href="/tools.html">Tools</a></li><li><a href="/contact.html">Contact</a></li></ul></nav><div class="menu-icon" onclick="toggleModal()">☰</div></div></header>

    <div id="layer1" class="star-layer" style="background-image: url('images/1.png'); z-index: 9;"></div>
    <div id="layer2" class="star-layer" style="background-image: url('images/2.png'); z-index: 8;"></div>
    <div id="layer3" class="star-layer" style="background-image: url('images/3.png'); z-index: 7;"></div>
    <div id="layer4" class="star-layer" style="background-image: url('images/27.png'); z-index: 6;"></div>
    <div id="layer5" class="star-layer" style="background-image: url('images/4.png'); z-index: 5;"></div>
    <div id="layer6" class="star-layer" style="background-image: url('images/26.png'); z-index: 4;"></div>
    <div id="layer7" class="star-layer" style="background-image: url('images/5.png'); z-index: 3;"></div>
    <div id="layer8" class="star-layer" style="background-image: url('images/25.png'); z-index: 2;"></div>
    <div id="layer9" class="star-layer" style="background-image: url('images/6.png'); z-index: 1;"></div>

    <div class="scroll-indicator-container"><div class="scroll-indicator">↓ Scroll ↓</div></div>
    <div class="content"><div id="journeyContainer" class="journey-container"><p style="color:white; text-align:center;">Loading Journey...</p></div></div>
    <footer><div class="footer-inner-container content-limiter"><div class="social-links"><a href="https://www.youtube.com/hansenspace" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube" onerror="this.style.display='none'"></a><a href="https://instagram.com/hansenspace" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram" onerror="this.style.display='none'"></a><a href="https://tiktok.com/@hansen_space" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok" onerror="this.style.display='none'"></a></div><p>© <span id="year">2025</span> Hansen Space.</p></div></footer>

    <script src="/scripts.js"></script>
    <script>
    // --- CORRECTED: Original Parallax scroll functionality restored ---
    window.addEventListener('scroll', function() {
        const scrollTop = window.scrollY;
        const totalLayers = 9;
        const startCoef = 0.15;
        const endCoef = 0.05; 
        const interval = (startCoef - endCoef) / (totalLayers - 1);
        for (let i = 1; i <= totalLayers; i++) {
            const layer = document.getElementById('layer' + i);
            if (layer) {
                const coef = startCoef - (i - 1) * interval;
                layer.style.backgroundPosition = 'center -' + (scrollTop * coef) + 'px';
            }
        }
    });

    // --- DYNAMIC Journey Content Building ---
    document.addEventListener('DOMContentLoaded', async () => {
        const journeyContainer = document.getElementById('journeyContainer');
        if (!journeyContainer) return;

        try {
            const response = await fetch('/data/journey_data.json?v=' + Date.now());
            if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
            
            const journeyData = await response.json();
            
            journeyContainer.innerHTML = ""; // Clear loading message
            
            journeyData.forEach(entry => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'journey-group';
                
                groupDiv.appendChild(createTextBox(entry.date_text, entry.body_text));

                if (entry.images && entry.images.length > 0) {
                    groupDiv.appendChild(createImageContainer(entry.images, entry.layout_type));
                }
                
                journeyContainer.appendChild(groupDiv);
            });

            attachScrollLinkHandlers();

        } catch (error) {
            console.error('Failed to load or build journey data:', error);
            journeyContainer.innerHTML = '<p style="color:white; text-align:center;">Failed to load journey content. Please try again later.</p>';
        }
    });
    
    function createTextBox(dateText, bodyText) {
        const div = document.createElement('div');
        div.className = 'group-text';
        
        let processedBody = (bodyText || "").replace(/\*(.*?)\*/g, "<i>$1</i>").replace(/_(.*?)_/g, "<i>$1</i>");
        processedBody = processedBody.replace(/\+([^+]+)\+\(([^)]+)\)/g, (match, text, url) => {
            if (/^\d+$/.test(url.trim())) {
                return `<a href="#" class="scroll-link" data-img="${url.trim()}">${text}</a>`;
            } else {
                return `<a href="${url.trim().replace(/^link to\s*/i, "")}" target="_blank" class="external-link">${text}</a>`;
            }
        });
        
        const paragraphs = processedBody.split("\n").map(p => p.trim()).filter(Boolean).map(p => `<p>${p}</p>`).join('');
        div.innerHTML = `<span class='date-title'>${dateText}</span>${paragraphs}`;
        return div;
    }

    function createImageContainer(images, layout) {
        const mainContainer = document.createElement('div');
        switch(layout) {
            case 'youtube_layout':
                mainContainer.className = 'yt-container';
                if (images[0]) mainContainer.appendChild(createImageBox(images[0]));
                const ytBottom = document.createElement('div');
                ytBottom.className = 'yt-bottom';
                images.slice(1).forEach(imgData => ytBottom.appendChild(createImageBox(imgData)));
                mainContainer.appendChild(ytBottom);
                break;
            case 'shorts_layout':
                mainContainer.className = 'shorts-container';
                const shortsTop = document.createElement('div');
                shortsTop.className = 'shorts-top';
                images.slice(0, 2).forEach(imgData => shortsTop.appendChild(createImageBox(imgData)));
                mainContainer.appendChild(shortsTop);
                const shortsBottom = document.createElement('div');
                shortsBottom.className = 'shorts-bottom';
                images.slice(2).forEach(imgData => shortsBottom.appendChild(createImageBox(imgData)));
                mainContainer.appendChild(shortsBottom);
                break;
            case 'spring_layout':
                 mainContainer.className = 'spring-grid';
                 images.forEach(imgData => mainContainer.appendChild(createImageBox(imgData)));
                 break;
            case 'standard_grid':
            default:
                mainContainer.className = 'group-grid';
                images.forEach(imgData => mainContainer.appendChild(createImageBox(imgData)));
                break;
        }
        return mainContainer;
    }
    
    function createImageBox(imageData) {
        const img = document.createElement('img');
        img.src = imageData.file_path;
        img.alt = imageData.alt_text || 'Journey image';
        if (imageData.aspect_ratio) img.style.aspectRatio = imageData.aspect_ratio;
        return img;
    }

    function handleScrollLink(event) {
        event.preventDefault();
        const link = event.currentTarget;
        const targetIndex = parseInt(link.getAttribute('data-img'), 10) - 1;
        const group = link.closest('.journey-group');
        if (!group || targetIndex < 0) return;
        const images = group.querySelectorAll('img');
        if (targetIndex >= images.length) return;
        const targetImage = images[targetIndex];
        targetImage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        targetImage.classList.add('flash');
        setTimeout(() => targetImage.classList.remove('flash'), 500);
    }

    function attachScrollLinkHandlers() {
        document.querySelectorAll('.scroll-link').forEach(link => {
            link.addEventListener('click', handleScrollLink);
        });
    }
    </script>
</body>
</html>